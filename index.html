<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“… Google Calendar ì¼ì • ë„ìš°ë¯¸</title>
  <style>
    body {
      font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
      background: #f9fafb;
      color: #222;
      max-width: 480px;
      margin: 0 auto;
      padding: 24px;
    }
    h2 {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 20px;
    }
    #signin-area, #form-area {
      background: #fff;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.04);
      margin-bottom: 20px;
    }
    input[type="text"], input[type="date"], select, button {
      display: block;
      width: 100%;
      padding: 14px 16px;
      margin-top: 12px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-sizing: border-box;
      appearance: none;
      background-color: #fff;
    }
    input::placeholder, select:invalid {
      color: #999;
    }
    select {
      background-image: url('data:image/svg+xml;charset=UTF-8,<svg fill="%23333" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
      background-repeat: no-repeat;
      background-position: right 14px center;
      background-size: 20px;
    }
    input:focus, select:focus, button:focus {
      outline: none;
      border-color: #3182f6;
    }
    button {
      background: #3182f6;
      color: #fff;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background: #2563eb;
    }
    p {
      margin-bottom: 0;
      font-size: 16px;
    }
    .time-row {
      display: flex;
      gap: 10px;
    }
    .time-row select, .time-row input[type="text"] {
      flex: 1;
    }
  </style>
</head>
<body>
  <h2>ìº˜ë¦°ë” ì¼ì • ë“±ë¡ ë„ìš°ë¯¸</h2>
  <div id="signin-area">
    <button id="login-btn" disabled>Google ë¡œê·¸ì¸í•˜ê³  ì‹œì‘í•˜ê¸°</button>
  </div>
  <div id="form-area" style="display:none;">
    <p><strong><span id="username">Google ì‚¬ìš©ì</span> ë‹˜, ë°˜ê°€ì›Œìš”!</strong></p>
    <select id="calendar-list" required>
      <option value="" disabled selected>ğŸ“ í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
    </select>
    <input type="text" id="title" placeholder="ì¼ì • ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
    <input type="date" id="date">

    <label style="margin-top:12px; text-align:left; display:block; font-size:14px; font-weight:500;">ì‹œì‘ ì‹œê°„</label>
    <div class="time-row">
      <select id="startAmPm">
        <option value="AM">ì˜¤ì „</option>
        <option value="PM">ì˜¤í›„</option>
      </select>
      <input type="text" id="startTime" placeholder="ì˜ˆ: 09:30">
    </div>

    <label style="margin-top:12px; text-align:left; display:block; font-size:14px; font-weight:500;">ì¢…ë£Œ ì‹œê°„</label>
    <div class="time-row">
      <select id="endAmPm">
        <option value="AM">ì˜¤ì „</option>
        <option value="PM">ì˜¤í›„</option>
      </select>
      <input type="text" id="endTime" placeholder="ì˜ˆ: 10:30">
    </div>

    <button onclick="addEvent()">ì¼ì • ë“±ë¡í•˜ê¸°</button>
  </div>

  <script>
    const CLIENT_ID = '106953701963-fpu3ouqhblfadj81geaep55apbi6ghk6.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyBNQTPJC_FoqKKCwO0QHxyzPkdVWuTGyr0';
    const DISCOVERY_DOCS = [
      'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest'
    ];
    const SCOPES = 'openid profile email https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly';

    let tokenClient;
    let gapiInited = false;

    const gapiLoaded = () => {
      gapi.load('client', async () => {
        await gapi.client.init({ apiKey: API_KEY, discoveryDocs: DISCOVERY_DOCS });
        gapiInited = true;

        const savedToken = localStorage.getItem('gToken');
        if (savedToken) {
          gapi.client.setToken(JSON.parse(savedToken));
          try {
            await loadUserCalendars();
            document.getElementById("signin-area").style.display = "none";
            document.getElementById("form-area").style.display = "block";
          } catch (error) {
            console.warn("ì´ˆê¸° ì„¸ì…˜ ë¡œë“œ ì‹¤íŒ¨", error);
          }
        } else {
          document.getElementById("login-btn").disabled = false;
        }
      });
    };

    const gisLoaded = () => {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: async (tokenResponse) => {
          gapi.client.setToken(tokenResponse);
          localStorage.setItem('gToken', JSON.stringify(tokenResponse));
          try {
            await loadUserCalendars();
            document.getElementById("signin-area").style.display = "none";
            document.getElementById("form-area").style.display = "block";
          } catch (error) {
            alert("ìº˜ë¦°ë” ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”: " + error.message);
          }
        }
      });

      document.getElementById("login-btn").disabled = false;
      document.getElementById("login-btn").addEventListener("click", () => {
        tokenClient.requestAccessToken({ prompt: 'consent' });
      });
    };

    async function loadUserCalendars() {
      const res = await gapi.client.calendar.calendarList.list();
      const select = document.getElementById("calendar-list");
      select.innerHTML = '<option value="" disabled selected>ğŸ“ í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>';
      res.result.items.forEach(cal => {
        const opt = document.createElement("option");
        opt.value = cal.id;
        opt.textContent = cal.summary;
        select.appendChild(opt);
      });
    }

    function convertTo24Hour(hourStr, ampm) {
      let [hour, minute] = hourStr.split(':');
      hour = parseInt(hour);
      if (ampm === 'PM' && hour < 12) hour += 12;
      if (ampm === 'AM' && hour === 12) hour = 0;
      return `${hour.toString().padStart(2, '0')}:${minute}:00`;
    }

    async function addEvent() {
      const title = document.getElementById("title").value;
      const date = document.getElementById("date").value;
      const startRaw = document.getElementById("startTime").value;
      const endRaw = document.getElementById("endTime").value;
      const startAmPm = document.getElementById("startAmPm").value;
      const endAmPm = document.getElementById("endAmPm").value;
      const calendarId = document.getElementById("calendar-list").value;

      const startTime = convertTo24Hour(startRaw, startAmPm);
      const endTime = convertTo24Hour(endRaw, endAmPm);

      const start = new Date(`${date}T${startTime}`);
      const end = new Date(`${date}T${endTime}`);

      const event = {
        summary: title,
        start: { dateTime: start.toISOString(), timeZone: 'Asia/Seoul' },
        end: { dateTime: end.toISOString(), timeZone: 'Asia/Seoul' }
      };

      try {
        await gapi.client.calendar.events.insert({ calendarId, resource: event });
        alert("ğŸ“… ì¼ì •ì´ ë“±ë¡ë˜ì—ˆì–´ìš”!");
        resetForm();
      } catch (err) {
        alert("âš ï¸ ì¼ì • ë“±ë¡ì— ì‹¤íŒ¨í–ˆì–´ìš”: " + err.message);
      }
    }

    function resetForm() {
      document.getElementById("title").value = "";
      document.getElementById("date").value = "";
      document.getElementById("startTime").value = "";
      document.getElementById("endTime").value = "";
    }
  </script>

  <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
