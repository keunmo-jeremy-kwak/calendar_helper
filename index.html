<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“… Google Calendar ë“±ë¡ Helper</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 500px;
      margin: 40px auto;
      text-align: center;
    }
    input, select, button {
      padding: 8px;
      margin: 6px;
      width: 90%;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h2>ğŸ“† Google Calendar ë“±ë¡ Helper</h2>
  <div id="signin-area">
    <button onclick="signIn()">ğŸ” Google Login</button>
  </div>
  
  <div id="form-area" style="display:none;">
    <p><strong>í™˜ì˜í•©ë‹ˆë‹¤, <span id="username"></span> ë‹˜!</strong></p>

    <select id="calendar-list"></select>

    <input type="text" id="title" placeholder="ì¼ì • ì œëª©">
    <input type="date" id="date">

    <select id="startTime"></select>
    <select id="endTime"></select>

    <button onclick="addEvent()">âœ… ì¼ì • ì¶”ê°€</button>
  </div>

  <!-- Google API -->
  <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
  <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

  <script>
    const CLIENT_ID = '106953701963-fpu3ouqhblfadj81geaep55apbi6ghk6.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyBNQTPJC_FoqKKCwO0QHxyzPkdVWuTGyr0';
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
    const SCOPES = 'https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar.readonly';

    let gapiInited = false;
    let tokenClient;

    function gapiLoaded() {
      gapi.load('client', async () => {
        await gapi.client.init({ apiKey: API_KEY, discoveryDocs: [DISCOVERY_DOC] });
        gapiInited = true;
      });
    }

    function gisLoaded() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: async (tokenResponse) => {
          if (tokenResponse && tokenResponse.access_token) {
            document.getElementById("signin-area").style.display = "none";
            document.getElementById("form-area").style.display = "block";

            // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
            const token = gapi.client.getToken();
            const userInfo = await gapi.client.request({ path: 'https://www.googleapis.com/oauth2/v3/userinfo' });
            document.getElementById("username").textContent = userInfo.result.name;

            // ìº˜ë¦°ë” ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
            const res = await gapi.client.calendar.calendarList.list();
            const select = document.getElementById("calendar-list");
            res.result.items.forEach(cal => {
              const opt = document.createElement("option");
              opt.value = cal.id;
              opt.textContent = cal.summary;
              select.appendChild(opt);
            });
          }
        }
      });
    }

    /*function signIn() {
      if (gapiInited && tokenClient) tokenClient.requestAccessToken();
    }*/

    function signIn() {
      const token = gapi.client.getToken();
        if (token) {
        // ì´ë¯¸ ë¡œê·¸ì¸ëœ ì„¸ì…˜ ì¡´ì¬
          document.getElementById("signin-area").style.display = "none";
          document.getElementById("form-area").style.display = "block";
      return;
      }
  
      // ë¡œê·¸ì¸ í•„ìš”
          tokenClient.requestAccessToken({ prompt: 'consent' }); // prompt: 'none' ì‚¬ìš© ì‹œ ë™ì˜ì°½ ì•ˆ ëœ¸
}


    async function addEvent() {
      const title = document.getElementById("title").value;
      const date = document.getElementById("date").value;
      const startTime = document.getElementById("startTime").value;
      const endTime = document.getElementById("endTime").value;
      const calendarId = document.getElementById("calendar-list").value;

      const start = new Date(`${date}T${startTime}`);
      const end = new Date(`${date}T${endTime}`);

      const event = {
        summary: title,
        start: { dateTime: start.toISOString(), timeZone: 'Asia/Seoul' },
        end: { dateTime: end.toISOString(), timeZone: 'Asia/Seoul' }
      };

      try {
        await gapi.client.calendar.events.insert({
          calendarId,
          resource: event
        });
        alert("âœ… ì¼ì •ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
        resetForm();
      } catch (err) {
        alert("âš ï¸ ì˜¤ë¥˜: " + err.message);
      }
    }

    function resetForm() {
      document.getElementById("title").value = "";
      document.getElementById("date").value = "";
      document.getElementById("startTime").selectedIndex = 0;
      document.getElementById("endTime").selectedIndex = 0;
    }

    // ì‹œê°„ ì˜µì…˜ ìƒì„±


  
    function createTimeOptions() {
      const start = document.getElementById("startTime");
      const end = document.getElementById("endTime");
      
      for (let h = 0; h < 24; h++) {
        for (let m = 0; m < 60; m += 10) {
          const hour = h.toString().padStart(2, '0');
          const minute = m.toString().padStart(2, '0');
          const value = `${hour}:${minute}:00`;

          const option1 = document.createElement("option");
          option1.value = `${hour}:${minute}:00`;
          option1.textContent = `${hour}:${minute}`;
          start.appendChild(option1);

          const option2 = document.createElement("option");
          option2.value = `${hour}:${minute}:00`;
          option2.textContent = `${hour}:${minute}`;
          end.appendChild(option2);
        }
      }
    } 



    // ë¡œë”© ì‹œ ì‹¤í–‰
    window.onload = createTimeOptions;
  </script>
</body>
</html>
