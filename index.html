<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>📅 GPT 캘린더 연동</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 500px;
      margin: 40px auto;
      text-align: center;
    }
    input, button {
      padding: 8px;
      margin: 6px;
      width: 90%;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h2>📆 Google Calendar 연동</h2>
  <div id="signin-area">
    <button onclick="signIn()">🔐 Google로 로그인</button>
  </div>
  
  <div id="form-area" style="display:none;">
    <p><strong>환영합니다, <span id="username"></span> 님!</strong></p>
    <input type="text" id="title" placeholder="일정 제목">
    <input type="date" id="date">
    <input type="time" id="startTime">
    <input type="time" id="endTime">
    <button onclick="addEvent()">✅ Google Calendar에 일정 추가</button>
  </div>

  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    const CLIENT_ID = '106953701963-fpu3ouqhblfadj81geaep55apbi6ghk6.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyBNQTPJC_FoqKKCwO0QHxyzPkdVWuTGyr0';
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
    const SCOPES = 'https://www.googleapis.com/auth/calendar.events';

    function signIn() {
      gapi.load('client:auth2', async () => {
        await gapi.client.init({
          apiKey: API_KEY,
          clientId: CLIENT_ID,
          discoveryDocs: [DISCOVERY_DOC],
          scope: SCOPES
        });

        const authInstance = gapi.auth2.getAuthInstance();
        await authInstance.signIn();
        const user = authInstance.currentUser.get().getBasicProfile();

        document.getElementById("username").textContent = user.getName();
        document.getElementById("signin-area").style.display = "none";
        document.getElementById("form-area").style.display = "block";
      });
    }

    async function addEvent() {
      const title = document.getElementById("title").value;
      const date = document.getElementById("date").value;
      const startTime = document.getElementById("startTime").value;
      const endTime = document.getElementById("endTime").value;

      const start = new Date(`${date}T${startTime}:00`);
      const end = new Date(`${date}T${endTime}:00`);

      const event = {
        summary: title,
        start: { dateTime: start.toISOString(), timeZone: 'Asia/Seoul' },
        end: { dateTime: end.toISOString(), timeZone: 'Asia/Seoul' }
      };

      try {
        const response = await gapi.client.calendar.events.insert({
          calendarId: 'primary',
          resource: event
        });
        alert("✅ 일정이 Google Calendar에 등록되었습니다!");
      } catch (err) {
        alert("⚠️ 오류 발생: " + err.message);
      }
    }
  </script>
</body>
</html>
