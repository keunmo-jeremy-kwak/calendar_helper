<script>
  const BASE_URL = "https://script.google.com/macros/s/AKfycb.../exec";

  fetch(BASE_URL + "?mode=list")
    .then(res => res.json())
    .then(data => {
      const select = document.getElementById("calendar");
      data.forEach(cal => {
        const option = document.createElement("option");
        option.value = cal.name;
        option.text = cal.name;
        select.appendChild(option);
      });
    })
    .catch(() => {
      document.getElementById("calendar").innerHTML = '<option>📛 캘린더 목록 로드 실패</option>';
    });

  fetch(BASE_URL + "?mode=week")
    .then(res => res.json())
    .then(events => {
      const list = document.getElementById("weekly-events");
      list.innerHTML = "";
      if (!events || events.length === 0) {
        list.innerHTML = "<li>이번주 일정이 없습니다.</li>";
      } else {
        events.forEach(e => {
          const li = document.createElement("li");
          li.innerText = `${e.date} - ${e.title}`;
          list.appendChild(li);
        });
      }
    })
    .catch(() => {
      document.getElementById("weekly-events").innerHTML = "<li>❌ 일정 불러오기 실패</li>";
    });

  function submitEvent() {
    const title = document.getElementById("title").value.trim();
    const description = document.getElementById("description").value.trim();
    const date = document.getElementById("date").value;
    const start = document.getElementById("start").value;
    const end = document.getElementById("end").value;
    const calendar = document.getElementById("calendar").value;
    const startUse = document.getElementById("start-option").value;
    const endUse = document.getElementById("end-option").value;

    if (!title || !date) {
      alert("제목과 날짜는 필수 입력입니다.");
      return;
    }

    const url = `${BASE_URL}?title=${encodeURIComponent(title)}&description=${encodeURIComponent(description)}&date=${date}` +
                `&start=${startUse === 'default' ? start : ''}&end=${endUse === 'default' ? end : ''}&calendar=${encodeURIComponent(calendar)}`;

    fetch(url)
      .then(res => res.json())
      .then(res => {
        document.getElementById("result").innerText = res.message || "✅ 등록 완료!";
      })
      .catch(err => {
        document.getElementById("result").innerText = "❌ 서버 오류 발생";
        console.error("Error submitting event:", err);
      });
  }
</script>
