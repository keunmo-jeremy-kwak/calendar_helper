<script>
  const BASE_URL = "https://script.google.com/macros/s/AKfycb.../exec";

  fetch(BASE_URL + "?mode=list")
    .then(res => res.json())
    .then(data => {
      const select = document.getElementById("calendar");
      data.forEach(cal => {
        const option = document.createElement("option");
        option.value = cal.name;
        option.text = cal.name;
        select.appendChild(option);
      });
    })
    .catch(() => {
      document.getElementById("calendar").innerHTML = '<option>ğŸ“› ìº˜ë¦°ë” ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨</option>';
    });

  fetch(BASE_URL + "?mode=week")
    .then(res => res.json())
    .then(events => {
      const list = document.getElementById("weekly-events");
      list.innerHTML = "";
      if (!events || events.length === 0) {
        list.innerHTML = "<li>ì´ë²ˆì£¼ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</li>";
      } else {
        events.forEach(e => {
          const li = document.createElement("li");
          li.innerText = `${e.date} - ${e.title}`;
          list.appendChild(li);
        });
      }
    })
    .catch(() => {
      document.getElementById("weekly-events").innerHTML = "<li>âŒ ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</li>";
    });

  function submitEvent() {
    const title = document.getElementById("title").value.trim();
    const description = document.getElementById("description").value.trim();
    const date = document.getElementById("date").value;
    const start = document.getElementById("start").value;
    const end = document.getElementById("end").value;
    const calendar = document.getElementById("calendar").value;
    const startUse = document.getElementById("start-option").value;
    const endUse = document.getElementById("end-option").value;

    if (!title || !date) {
      alert("ì œëª©ê³¼ ë‚ ì§œëŠ” í•„ìˆ˜ ì…ë ¥ì…ë‹ˆë‹¤.");
      return;
    }

    const url = `${BASE_URL}?title=${encodeURIComponent(title)}&description=${encodeURIComponent(description)}&date=${date}` +
                `&start=${startUse === 'default' ? start : ''}&end=${endUse === 'default' ? end : ''}&calendar=${encodeURIComponent(calendar)}`;

    fetch(url)
      .then(res => res.json())
      .then(res => {
        document.getElementById("result").innerText = res.message || "âœ… ë“±ë¡ ì™„ë£Œ!";
      })
      .catch(err => {
        document.getElementById("result").innerText = "âŒ ì„œë²„ ì˜¤ë¥˜ ë°œìƒ";
        console.error("Error submitting event:", err);
      });
  }
</script>
